{% extends 'base.html' %}

{% block title %}Category - Library App{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h1 class="mb-0" id="category-name">Loading... üè∑Ô∏è</h1>
    </div>
    <div class="card-body">
        <p id="category-description"></p>
    </div>
</div>

<h2>üìö Books in this Category</h2>
<div class="row" id="books-list">
    <!-- JS will render book cards here -->
</div>

<a href="{% url 'category_list' %}" class="btn btn-secondary mt-4">
    <i class="bi bi-arrow-left"></i> Back to Categories
</a>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const slug = window.location.pathname.split('/').filter(Boolean).pop(); // get last segment of URL

        fetch(`/api/categories/${slug}/`)
            .then(response => {
                if (!response.ok) throw new Error("Category not found");
                return response.json();
            })
            .then(data => {
                const { category, books } = data;

                // Update category info
                document.getElementById("category-name").innerText = `${category.name} üè∑Ô∏è`;
                document.getElementById("category-description").innerText = category.description || "";

                const booksList = document.getElementById("books-list");
                booksList.innerHTML = '';

                if (!books.length) {
                    booksList.innerHTML = `
                        <div class="col-12">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> No books in this category yet. üì≠
                            </div>
                        </div>
                    `;
                    return;
                }

                books.forEach(book => {
                    const card = document.createElement('div');
                    card.classList.add('col-md-4', 'mb-4');
                    card.innerHTML = `
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">${book.title} üìñ</h5>
                                <h6 class="card-subtitle mb-2 text-muted">By ${book.author.name} ‚úçÔ∏è</h6>
                                <p class="card-text">${book.summary.slice(0, 100)}...</p>
                                <a href="/books/${book.id}" class="btn btn-primary">View Book üëÄ</a>
                            </div>
                        </div>
                    `;
                    booksList.appendChild(card);
                });
            })
            .catch(error => {
                console.error("Error:", error);
                document.getElementById("category-name").innerText = "Category not found üò¢";
            });
    });
</script>
{% endblock %}
